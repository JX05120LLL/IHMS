{"remainingRequest":"D:\\code\\project\\健康管理系统\\健康管理系统\\前端\\personal-heath-view\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\code\\project\\健康管理系统\\健康管理系统\\前端\\personal-heath-view\\src\\views\\doctor\\DoctorConsultations.vue?vue&type=style&index=0&id=e9979996&scoped=true&lang=scss&","dependencies":[{"path":"D:\\code\\project\\健康管理系统\\健康管理系统\\前端\\personal-heath-view\\src\\views\\doctor\\DoctorConsultations.vue","mtime":1746436006000},{"path":"D:\\code\\project\\健康管理系统\\健康管理系统\\前端\\personal-heath-view\\node_modules\\css-loader\\dist\\cjs.js","mtime":1746543376221},{"path":"D:\\code\\project\\健康管理系统\\健康管理系统\\前端\\personal-heath-view\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":1746543377294},{"path":"D:\\code\\project\\健康管理系统\\健康管理系统\\前端\\personal-heath-view\\node_modules\\postcss-loader\\src\\index.js","mtime":1746543376593},{"path":"D:\\code\\project\\健康管理系统\\健康管理系统\\前端\\personal-heath-view\\node_modules\\sass-loader\\dist\\cjs.js","mtime":1746543375888},{"path":"D:\\code\\project\\健康管理系统\\健康管理系统\\前端\\personal-heath-view\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1746543375897},{"path":"D:\\code\\project\\健康管理系统\\健康管理系统\\前端\\personal-heath-view\\node_modules\\vue-loader\\lib\\index.js","mtime":1746543376907}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKDQouZG9jdG9yLWNvbnN1bHRhdGlvbnMgew0KICBwYWRkaW5nOiAyMHB4Ow0KICANCiAgaDIgew0KICAgIG1hcmdpbi1ib3R0b206IDIwcHg7DQogIH0NCiAgDQogIC5wYWdpbmF0aW9uIHsNCiAgICBtYXJnaW4tdG9wOiAyMHB4Ow0KICAgIGRpc3BsYXk6IGZsZXg7DQogICAganVzdGlmeS1jb250ZW50OiBjZW50ZXI7DQogIH0NCn0NCg=="},{"version":3,"sources":["DoctorConsultations.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAsQA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA","file":"DoctorConsultations.vue","sourceRoot":"src/views/doctor","sourcesContent":["<template>\r\n  <div class=\"doctor-consultations\">\r\n    <h2>我的患者咨询</h2>\r\n    \r\n    <el-tabs v-model=\"activeTab\" @tab-click=\"handleTabChange\">\r\n      <el-tab-pane label=\"进行中的咨询\" name=\"active\">\r\n        <el-table\r\n          :data=\"consultations\"\r\n          style=\"width: 100%\"\r\n          v-loading=\"loading\"\r\n          border\r\n        >\r\n          <el-table-column\r\n            prop=\"title\"\r\n            label=\"咨询主题\"\r\n            min-width=\"180\"\r\n          ></el-table-column>\r\n          <el-table-column\r\n            prop=\"patientName\"\r\n            label=\"患者姓名\"\r\n            width=\"120\"\r\n          ></el-table-column>\r\n          <el-table-column\r\n            prop=\"createTime\"\r\n            label=\"创建时间\"\r\n            width=\"180\"\r\n            :formatter=\"formatDate\"\r\n          ></el-table-column>\r\n          <el-table-column\r\n            label=\"状态\"\r\n            width=\"100\"\r\n            align=\"center\"\r\n          >\r\n            <template slot-scope=\"scope\">\r\n              <el-tag\r\n                :type=\"scope.row.status === 0 ? 'success' : 'info'\"\r\n              >\r\n                {{ scope.row.status === 0 ? '进行中' : '已结束' }}\r\n              </el-tag>\r\n            </template>\r\n          </el-table-column>\r\n          <el-table-column\r\n            label=\"操作\"\r\n            width=\"180\"\r\n            align=\"center\"\r\n          >\r\n            <template slot-scope=\"scope\">\r\n              <el-button\r\n                type=\"primary\"\r\n                size=\"small\"\r\n                @click=\"enterChat(scope.row)\"\r\n              >\r\n                {{ scope.row.status === 0 ? '继续咨询' : '查看记录' }}\r\n              </el-button>\r\n              <el-button\r\n                v-if=\"scope.row.status === 0\"\r\n                type=\"danger\"\r\n                size=\"small\"\r\n                @click=\"endConsultation(scope.row)\"\r\n              >\r\n                结束\r\n              </el-button>\r\n            </template>\r\n          </el-table-column>\r\n        </el-table>\r\n        \r\n        <div class=\"pagination\" v-if=\"total > 0\">\r\n          <el-pagination\r\n            background\r\n            layout=\"prev, pager, next\"\r\n            :total=\"total\"\r\n            :page-size=\"pageSize\"\r\n            :current-page.sync=\"currentPage\"\r\n            @current-change=\"handleCurrentChange\"\r\n          ></el-pagination>\r\n        </div>\r\n      </el-tab-pane>\r\n      \r\n      <el-tab-pane label=\"已结束的咨询\" name=\"completed\">\r\n        <el-table\r\n          :data=\"consultations\"\r\n          style=\"width: 100%\"\r\n          v-loading=\"loading\"\r\n          border\r\n        >\r\n          <el-table-column\r\n            prop=\"title\"\r\n            label=\"咨询主题\"\r\n            min-width=\"180\"\r\n          ></el-table-column>\r\n          <el-table-column\r\n            prop=\"patientName\"\r\n            label=\"患者姓名\"\r\n            width=\"120\"\r\n          ></el-table-column>\r\n          <el-table-column\r\n            prop=\"createTime\"\r\n            label=\"创建时间\"\r\n            width=\"180\"\r\n            :formatter=\"formatDate\"\r\n          ></el-table-column>\r\n          <el-table-column\r\n            prop=\"endTime\"\r\n            label=\"结束时间\"\r\n            width=\"180\"\r\n            :formatter=\"formatDate\"\r\n          ></el-table-column>\r\n          <el-table-column\r\n            label=\"操作\"\r\n            width=\"120\"\r\n            align=\"center\"\r\n          >\r\n            <template slot-scope=\"scope\">\r\n              <el-button\r\n                type=\"info\"\r\n                size=\"small\"\r\n                @click=\"enterChat(scope.row)\"\r\n              >\r\n                查看记录\r\n              </el-button>\r\n            </template>\r\n          </el-table-column>\r\n        </el-table>\r\n        \r\n        <div class=\"pagination\" v-if=\"total > 0\">\r\n          <el-pagination\r\n            background\r\n            layout=\"prev, pager, next\"\r\n            :total=\"total\"\r\n            :page-size=\"pageSize\"\r\n            :current-page.sync=\"currentPage\"\r\n            @current-change=\"handleCurrentChange\"\r\n          ></el-pagination>\r\n        </div>\r\n      </el-tab-pane>\r\n    </el-tabs>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nexport default {\r\n  name: 'DoctorConsultations',\r\n  data() {\r\n    return {\r\n      activeTab: 'active',\r\n      consultations: [],\r\n      loading: false,\r\n      currentPage: 1,\r\n      pageSize: 10,\r\n      total: 0,\r\n      doctorId: null\r\n    }\r\n  },\r\n  created() {\r\n    // 获取医生ID\r\n    const doctorInfo = JSON.parse(sessionStorage.getItem('doctorInfo') || '{}')\r\n    this.doctorId = doctorInfo.id\r\n    \r\n    // 加载咨询列表\r\n    this.loadConsultations()\r\n  },\r\n  methods: {\r\n    // 加载咨询列表\r\n    async loadConsultations() {\r\n      if (!this.doctorId) {\r\n        this.$message.error('医生信息不存在，请重新登录')\r\n        return\r\n      }\r\n      \r\n      this.loading = true\r\n      try {\r\n        // 根据当前选项卡加载不同状态的咨询\r\n        const status = this.activeTab === 'active' ? 0 : 1\r\n        const response = await this.$axios.get('/consultation/doctor-list', {\r\n          params: {\r\n            doctorId: this.doctorId,\r\n            status: status,\r\n            current: this.currentPage - 1,\r\n            size: this.pageSize\r\n          }\r\n        })\r\n        \r\n        if (response.data.code === 200) {\r\n          this.consultations = response.data.data.records || []\r\n          this.total = response.data.data.total || 0\r\n          \r\n          // 加载患者信息\r\n          for (const consultation of this.consultations) {\r\n            await this.loadPatientInfo(consultation)\r\n          }\r\n        } else {\r\n          this.$message.error(response.data.msg || '获取咨询列表失败')\r\n        }\r\n      } catch (error) {\r\n        console.error('加载咨询列表出错', error)\r\n        this.$message.error('加载咨询列表出错')\r\n      } finally {\r\n        this.loading = false\r\n      }\r\n    },\r\n    // 加载患者信息\r\n    async loadPatientInfo(consultation) {\r\n      try {\r\n        const response = await this.$axios.get(`/user/detail/${consultation.patientId}`)\r\n        if (response.data.code === 200) {\r\n          const patient = response.data.data\r\n          this.$set(consultation, 'patientName', patient.userName || '未知患者')\r\n        }\r\n      } catch (error) {\r\n        console.error('获取患者信息出错', error)\r\n        this.$set(consultation, 'patientName', '未知患者')\r\n      }\r\n    },\r\n    // 进入聊天页面\r\n    enterChat(consultation) {\r\n      this.$router.push(`/doctor-chat/${consultation.id}`)\r\n    },\r\n    // 结束咨询\r\n    async endConsultation(consultation) {\r\n      try {\r\n        const confirmed = await this.$confirm('确定要结束此次咨询吗?', '提示', {\r\n          confirmButtonText: '确定',\r\n          cancelButtonText: '取消',\r\n          type: 'warning'\r\n        })\r\n        \r\n        if (confirmed) {\r\n          const response = await this.$axios.put(`/consultation/end/${consultation.id}`)\r\n          if (response.data.code === 200) {\r\n            this.$message.success('咨询已结束')\r\n            this.loadConsultations()\r\n          } else {\r\n            this.$message.error(response.data.msg || '结束咨询失败')\r\n          }\r\n        }\r\n      } catch (error) {\r\n        if (error !== 'cancel') {\r\n          console.error('结束咨询出错', error)\r\n          this.$message.error('结束咨询出错')\r\n        }\r\n      }\r\n    },\r\n    // 切换标签页\r\n    handleTabChange() {\r\n      this.currentPage = 1\r\n      this.loadConsultations()\r\n    },\r\n    // 切换页码\r\n    handleCurrentChange() {\r\n      this.loadConsultations()\r\n    },\r\n    // 格式化日期\r\n    formatDate(row, column, cellValue) {\r\n      if (!cellValue) return '-'\r\n      const date = new Date(cellValue)\r\n      return `${date.getFullYear()}-${(date.getMonth() + 1).toString().padStart(2, '0')}-${date.getDate().toString().padStart(2, '0')} ${date.getHours().toString().padStart(2, '0')}:${date.getMinutes().toString().padStart(2, '0')}`\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<style scoped lang=\"scss\">\r\n.doctor-consultations {\r\n  padding: 20px;\r\n  \r\n  h2 {\r\n    margin-bottom: 20px;\r\n  }\r\n  \r\n  .pagination {\r\n    margin-top: 20px;\r\n    display: flex;\r\n    justify-content: center;\r\n  }\r\n}\r\n</style> "]}]}