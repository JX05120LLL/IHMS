{"remainingRequest":"D:\\code\\project\\健康管理系统\\健康管理系统\\前端\\personal-heath-view\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\code\\project\\健康管理系统\\健康管理系统\\前端\\personal-heath-view\\src\\views\\user\\ConsultationChat.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\code\\project\\健康管理系统\\健康管理系统\\前端\\personal-heath-view\\src\\views\\user\\ConsultationChat.vue","mtime":1746435866000},{"path":"D:\\code\\project\\健康管理系统\\健康管理系统\\前端\\personal-heath-view\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1746543375897},{"path":"D:\\code\\project\\健康管理系统\\健康管理系统\\前端\\personal-heath-view\\node_modules\\babel-loader\\lib\\index.js","mtime":1746543376599},{"path":"D:\\code\\project\\健康管理系统\\健康管理系统\\前端\\personal-heath-view\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1746543375897},{"path":"D:\\code\\project\\健康管理系统\\健康管理系统\\前端\\personal-heath-view\\node_modules\\vue-loader\\lib\\index.js","mtime":1746543376907}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KDQppbXBvcnQgd2Vic29ja2V0U2VydmljZSBmcm9tICdAL3V0aWxzL3dlYnNvY2tldFNlcnZpY2UnDQoNCmV4cG9ydCBkZWZhdWx0IHsNCiAgbmFtZTogJ0NvbnN1bHRhdGlvbkNoYXQnLA0KICBkYXRhKCkgew0KICAgIHJldHVybiB7DQogICAgICBjb25zdWx0YXRpb25JZDogbnVsbCwNCiAgICAgIGNvbnN1bHRhdGlvbjogbnVsbCwNCiAgICAgIG1lc3NhZ2VzOiBbXSwNCiAgICAgIGxvYWRpbmc6IGZhbHNlLA0KICAgICAgaW5wdXRNZXNzYWdlOiAnJywNCiAgICAgIGN1cnJlbnRVc2VySWQ6IG51bGwsDQogICAgICB1c2VyQXZhdGFyOiAnJywNCiAgICAgIGRvY3RvckF2YXRhcjogJycsDQogICAgICBkb2N0b3JOYW1lOiAnJywNCiAgICAgIC8vIOWBpeW6t+aVsOaNrg0KICAgICAgaGVhbHRoRGF0YURpYWxvZ1Zpc2libGU6IGZhbHNlLA0KICAgICAgaGVhbHRoRGF0YUxpc3Q6IFtdLA0KICAgICAgaGVhbHRoRGF0YUxvYWRpbmc6IGZhbHNlLA0KICAgICAgc2VsZWN0ZWRIZWFsdGhEYXRhOiBudWxsLA0KICAgICAgLy8g6L2u6K+i5a6a5pe25ZmoDQogICAgICBwb2xsaW5nVGltZXI6IG51bGwNCiAgICB9DQogIH0sDQogIGNyZWF0ZWQoKSB7DQogICAgdGhpcy5jb25zdWx0YXRpb25JZCA9IHRoaXMuJHJvdXRlLnBhcmFtcy5pZA0KICAgIC8vIOiOt+WPluW9k+WJjeeUqOaIt+S/oeaBrw0KICAgIGNvbnN0IHVzZXJJbmZvID0gSlNPTi5wYXJzZShzZXNzaW9uU3RvcmFnZS5nZXRJdGVtKCd1c2VySW5mbycpIHx8ICd7fScpDQogICAgdGhpcy5jdXJyZW50VXNlcklkID0gdXNlckluZm8uaWQNCiAgICB0aGlzLnVzZXJBdmF0YXIgPSB1c2VySW5mby51cmwgfHwgJy9pbWcvZGVmYXVsdC1hdmF0YXIucG5nJw0KICAgIA0KICAgIC8vIOWIneWni+WMluaVsOaNrg0KICAgIHRoaXMubG9hZENvbnN1bHRhdGlvbkRldGFpbCgpDQogICAgdGhpcy5sb2FkTWVzc2FnZXMoKQ0KICAgIA0KICAgIC8vIOWIneWni+WMlldlYlNvY2tldOi/nuaOpQ0KICAgIHRoaXMuaW5pdFdlYlNvY2tldCgpDQogIH0sDQogIGJlZm9yZURlc3Ryb3koKSB7DQogICAgLy8g5pat5byAV2ViU29ja2V06L+e5o6lDQogICAgd2Vic29ja2V0U2VydmljZS5kaXNjb25uZWN0KCkNCiAgfSwNCiAgbWV0aG9kczogew0KICAgIC8vIOi/lOWbnuS4iuS4gOmhtQ0KICAgIGdvQmFjaygpIHsNCiAgICAgIHRoaXMuJHJvdXRlci5wdXNoKCcvZG9jdG9yLWNvbnN1bHRhdGlvbicpDQogICAgfSwNCiAgICAvLyDliqDovb3lkqjor6Lor6bmg4UNCiAgICBhc3luYyBsb2FkQ29uc3VsdGF0aW9uRGV0YWlsKCkgew0KICAgICAgaWYgKCF0aGlzLmNvbnN1bHRhdGlvbklkKSByZXR1cm4NCiAgICAgIA0KICAgICAgdGhpcy5sb2FkaW5nID0gdHJ1ZQ0KICAgICAgdHJ5IHsNCiAgICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCB0aGlzLiRheGlvcy5nZXQoYC9jb25zdWx0YXRpb24vZGV0YWlsLyR7dGhpcy5jb25zdWx0YXRpb25JZH1gKQ0KICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5jb2RlID09PSAyMDApIHsNCiAgICAgICAgICB0aGlzLmNvbnN1bHRhdGlvbiA9IHJlc3BvbnNlLmRhdGEuZGF0YQ0KICAgICAgICAgIA0KICAgICAgICAgIC8vIOWKoOi9veWMu+eUn+S/oeaBrw0KICAgICAgICAgIGF3YWl0IHRoaXMubG9hZERvY3RvckluZm8odGhpcy5jb25zdWx0YXRpb24uZG9jdG9ySWQpDQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgdGhpcy4kbWVzc2FnZS5lcnJvcihyZXNwb25zZS5kYXRhLm1zZyB8fCAn6I635Y+W5ZKo6K+i6K+m5oOF5aSx6LSlJykNCiAgICAgICAgfQ0KICAgICAgfSBjYXRjaCAoZXJyb3IpIHsNCiAgICAgICAgY29uc29sZS5lcnJvcign6I635Y+W5ZKo6K+i6K+m5oOF5Ye66ZSZJywgZXJyb3IpDQogICAgICAgIHRoaXMuJG1lc3NhZ2UuZXJyb3IoJ+iOt+WPluWSqOivouivpuaDheWHuumUmScpDQogICAgICB9IGZpbmFsbHkgew0KICAgICAgICB0aGlzLmxvYWRpbmcgPSBmYWxzZQ0KICAgICAgfQ0KICAgIH0sDQogICAgLy8g5Yqg6L295Yy755Sf5L+h5oGvDQogICAgYXN5bmMgbG9hZERvY3RvckluZm8oZG9jdG9ySWQpIHsNCiAgICAgIHRyeSB7DQogICAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgdGhpcy4kYXhpb3MuZ2V0KGAvZG9jdG9yL2RldGFpbC8ke2RvY3RvcklkfWApDQogICAgICAgIGlmIChyZXNwb25zZS5kYXRhLmNvZGUgPT09IDIwMCkgew0KICAgICAgICAgIGNvbnN0IGRvY3RvciA9IHJlc3BvbnNlLmRhdGEuZGF0YQ0KICAgICAgICAgIHRoaXMuZG9jdG9yTmFtZSA9IGRvY3Rvci5uYW1lDQogICAgICAgICAgdGhpcy5kb2N0b3JBdmF0YXIgPSBkb2N0b3IuYXZhdGFyIHx8ICcvaW1nL2RlZmF1bHQtYXZhdGFyLnBuZycNCiAgICAgICAgfQ0KICAgICAgfSBjYXRjaCAoZXJyb3IpIHsNCiAgICAgICAgY29uc29sZS5lcnJvcign6I635Y+W5Yy755Sf5L+h5oGv5Ye66ZSZJywgZXJyb3IpDQogICAgICB9DQogICAgfSwNCiAgICAvLyDliqDovb3mtojmga/liJfooagNCiAgICBhc3luYyBsb2FkTWVzc2FnZXMoKSB7DQogICAgICBpZiAoIXRoaXMuY29uc3VsdGF0aW9uSWQpIHJldHVybg0KICAgICAgDQogICAgICB0cnkgew0KICAgICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHRoaXMuJGF4aW9zLmdldChgL2RvY3Rvci1tZXNzYWdlL2xpc3Q/Y29uc3VsdGF0aW9uSWQ9JHt0aGlzLmNvbnN1bHRhdGlvbklkfWApDQogICAgICAgIGlmIChyZXNwb25zZS5kYXRhLmNvZGUgPT09IDIwMCkgew0KICAgICAgICAgIHRoaXMubWVzc2FnZXMgPSByZXNwb25zZS5kYXRhLmRhdGENCiAgICAgICAgICANCiAgICAgICAgICAvLyDliqDovb3mtojmga/kuK3nmoTlgaXlurfmlbDmja4NCiAgICAgICAgICB0aGlzLmxvYWRNZXNzYWdlc0hlYWx0aERhdGEoKQ0KICAgICAgICAgIA0KICAgICAgICAgIC8vIOa7muWKqOWIsOW6lemDqA0KICAgICAgICAgIHRoaXMuJG5leHRUaWNrKCgpID0+IHsNCiAgICAgICAgICAgIHRoaXMuc2Nyb2xsVG9Cb3R0b20oKQ0KICAgICAgICAgIH0pDQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgdGhpcy4kbWVzc2FnZS5lcnJvcihyZXNwb25zZS5kYXRhLm1zZyB8fCAn6I635Y+W5raI5oGv5YiX6KGo5aSx6LSlJykNCiAgICAgICAgfQ0KICAgICAgfSBjYXRjaCAoZXJyb3IpIHsNCiAgICAgICAgY29uc29sZS5lcnJvcign6I635Y+W5raI5oGv5YiX6KGo5Ye66ZSZJywgZXJyb3IpDQogICAgICB9DQogICAgfSwNCiAgICAvLyDliqDovb3mtojmga/kuK3nmoTlgaXlurfmlbDmja4NCiAgICBhc3luYyBsb2FkTWVzc2FnZXNIZWFsdGhEYXRhKCkgew0KICAgICAgY29uc3QgaGVhbHRoRGF0YU1lc3NhZ2VzID0gdGhpcy5tZXNzYWdlcy5maWx0ZXIobSA9PiBtLm1lc3NhZ2VUeXBlID09PSAyICYmIG0uaGVhbHRoRGF0YUlkKQ0KICAgICAgDQogICAgICBmb3IgKGNvbnN0IG1lc3NhZ2Ugb2YgaGVhbHRoRGF0YU1lc3NhZ2VzKSB7DQogICAgICAgIGlmIChtZXNzYWdlLmhlYWx0aERhdGEpIGNvbnRpbnVlDQogICAgICAgIA0KICAgICAgICB0cnkgew0KICAgICAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgdGhpcy4kYXhpb3MuZ2V0KGAvaGVhbHRoL3JlY29yZC9kZXRhaWwvJHttZXNzYWdlLmhlYWx0aERhdGFJZH1gKQ0KICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhLmNvZGUgPT09IDIwMCkgew0KICAgICAgICAgICAgdGhpcy4kc2V0KG1lc3NhZ2UsICdoZWFsdGhEYXRhJywgcmVzcG9uc2UuZGF0YS5kYXRhKQ0KICAgICAgICAgIH0NCiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHsNCiAgICAgICAgICBjb25zb2xlLmVycm9yKCfojrflj5blgaXlurfmlbDmja7or6bmg4Xlh7rplJknLCBlcnJvcikNCiAgICAgICAgfQ0KICAgICAgfQ0KICAgIH0sDQogICAgLy8g5Yid5aeL5YyWV2ViU29ja2V06L+e5o6lDQogICAgYXN5bmMgaW5pdFdlYlNvY2tldCgpIHsNCiAgICAgIHRyeSB7DQogICAgICAgIGF3YWl0IHdlYnNvY2tldFNlcnZpY2UuY29ubmVjdCh0aGlzLmNvbnN1bHRhdGlvbklkLCB0aGlzLmhhbmRsZU5ld01lc3NhZ2UpDQogICAgICB9IGNhdGNoIChlcnJvcikgew0KICAgICAgICBjb25zb2xlLmVycm9yKCdXZWJTb2NrZXTov57mjqXlpLHotKXvvIzlsIbkvb/nlKjova7or6LmqKHlvI8nLCBlcnJvcikNCiAgICAgICAgLy8g5aaC5p6cV2ViU29ja2V06L+e5o6l5aSx6LSl77yM5L2/55So6L2u6K+i5L2c5Li65aSH6YCJ5pa55qGIDQogICAgICAgIHRoaXMuc3RhcnRQb2xsaW5nKCkNCiAgICAgIH0NCiAgICB9LA0KICAgIC8vIOWkhOeQhuaWsOa2iOaBrw0KICAgIGhhbmRsZU5ld01lc3NhZ2UobWVzc2FnZSkgew0KICAgICAgLy8g5qOA5p+l5raI5oGv5piv5ZCm5bey5a2Y5Zyo77yI6Ziy5q2i6YeN5aSN77yJDQogICAgICBjb25zdCBleGlzdHMgPSB0aGlzLm1lc3NhZ2VzLnNvbWUobSA9PiBtLmlkID09PSBtZXNzYWdlLmlkKQ0KICAgICAgaWYgKCFleGlzdHMpIHsNCiAgICAgICAgdGhpcy5tZXNzYWdlcy5wdXNoKG1lc3NhZ2UpDQogICAgICAgIA0KICAgICAgICAvLyDlpoLmnpzmmK/lgaXlurfmlbDmja7mtojmga/kvYbmsqHmnInlgaXlurfmlbDmja7or6bmg4XvvIzlsJ3or5XliqDovb0NCiAgICAgICAgaWYgKG1lc3NhZ2UubWVzc2FnZVR5cGUgPT09IDIgJiYgbWVzc2FnZS5oZWFsdGhEYXRhSWQgJiYgIW1lc3NhZ2UuaGVhbHRoRGF0YSkgew0KICAgICAgICAgIHRoaXMubG9hZEhlYWx0aERhdGEobWVzc2FnZSkNCiAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgLy8g5rua5Yqo5Yiw5bqV6YOoDQogICAgICAgIHRoaXMuJG5leHRUaWNrKCgpID0+IHsNCiAgICAgICAgICB0aGlzLnNjcm9sbFRvQm90dG9tKCkNCiAgICAgICAgfSkNCiAgICAgIH0NCiAgICB9LA0KICAgIC8vIOWKoOi9veWNleadoea2iOaBr+eahOWBpeW6t+aVsOaNrg0KICAgIGFzeW5jIGxvYWRIZWFsdGhEYXRhKG1lc3NhZ2UpIHsNCiAgICAgIHRyeSB7DQogICAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgdGhpcy4kYXhpb3MuZ2V0KGAvaGVhbHRoL3JlY29yZC9kZXRhaWwvJHttZXNzYWdlLmhlYWx0aERhdGFJZH1gKQ0KICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5jb2RlID09PSAyMDApIHsNCiAgICAgICAgICB0aGlzLiRzZXQobWVzc2FnZSwgJ2hlYWx0aERhdGEnLCByZXNwb25zZS5kYXRhLmRhdGEpDQogICAgICAgIH0NCiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7DQogICAgICAgIGNvbnNvbGUuZXJyb3IoJ+iOt+WPluWBpeW6t+aVsOaNruivpuaDheWHuumUmScsIGVycm9yKQ0KICAgICAgfQ0KICAgIH0sDQogICAgLy8g5Y+R6YCB5raI5oGvDQogICAgYXN5bmMgc2VuZE1lc3NhZ2UoKSB7DQogICAgICBpZiAoIXRoaXMuaW5wdXRNZXNzYWdlLnRyaW0oKSkgcmV0dXJuDQogICAgICANCiAgICAgIHRyeSB7DQogICAgICAgIGNvbnN0IG1lc3NhZ2UgPSB7DQogICAgICAgICAgY29uc3VsdGF0aW9uSWQ6IHRoaXMuY29uc3VsdGF0aW9uSWQsDQogICAgICAgICAgc2VuZGVySWQ6IHRoaXMuY3VycmVudFVzZXJJZCwNCiAgICAgICAgICBzZW5kZXJUeXBlOiAwLCAvLyAwOuaCo+iAhQ0KICAgICAgICAgIHJlY2VpdmVySWQ6IHRoaXMuY29uc3VsdGF0aW9uLmRvY3RvcklkLA0KICAgICAgICAgIGNvbnRlbnQ6IHRoaXMuaW5wdXRNZXNzYWdlLA0KICAgICAgICAgIG1lc3NhZ2VUeXBlOiAwLCAvLyAwOuaWh+acrA0KICAgICAgICAgIGlzUmVhZDogMCAvLyAwOuacquivuw0KICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAvLyDlpoLmnpxXZWJTb2NrZXTlt7Lov57mjqXvvIzkvb/nlKhXZWJTb2NrZXTlj5HpgIHmtojmga8NCiAgICAgICAgaWYgKHdlYnNvY2tldFNlcnZpY2UuaXNDb25uZWN0ZWQoKSkgew0KICAgICAgICAgIGNvbnN0IHN1Y2Nlc3MgPSB3ZWJzb2NrZXRTZXJ2aWNlLnNlbmRNZXNzYWdlKHRoaXMuY29uc3VsdGF0aW9uSWQsIG1lc3NhZ2UpDQogICAgICAgICAgaWYgKHN1Y2Nlc3MpIHsNCiAgICAgICAgICAgIC8vIOa4heepuui+k+WFpeahhg0KICAgICAgICAgICAgdGhpcy5pbnB1dE1lc3NhZ2UgPSAnJw0KICAgICAgICAgICAgcmV0dXJuDQogICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAvLyBXZWJTb2NrZXTlj5HpgIHlpLHotKXmiJbmnKrov57mjqXvvIzkvb/nlKhIVFRQIEFQSeWPkemAgQ0KICAgICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHRoaXMuJGF4aW9zLnBvc3QoJy9kb2N0b3ItbWVzc2FnZS9zZW5kJywgbWVzc2FnZSkNCiAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEuY29kZSA9PT0gMjAwKSB7DQogICAgICAgICAgLy8g5riF56m66L6T5YWl5qGGDQogICAgICAgICAgdGhpcy5pbnB1dE1lc3NhZ2UgPSAnJw0KICAgICAgICAgIC8vIOmHjeaWsOWKoOi9vea2iOaBrw0KICAgICAgICAgIHRoaXMubG9hZE1lc3NhZ2VzKCkNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICB0aGlzLiRtZXNzYWdlLmVycm9yKHJlc3BvbnNlLmRhdGEubXNnIHx8ICflj5HpgIHmtojmga/lpLHotKUnKQ0KICAgICAgICB9DQogICAgICB9IGNhdGNoIChlcnJvcikgew0KICAgICAgICBjb25zb2xlLmVycm9yKCflj5HpgIHmtojmga/lh7rplJknLCBlcnJvcikNCiAgICAgICAgdGhpcy4kbWVzc2FnZS5lcnJvcign5Y+R6YCB5raI5oGv5Ye66ZSZJykNCiAgICAgIH0NCiAgICB9LA0KICAgIC8vIOe7k+adn+S8muivnQ0KICAgIGFzeW5jIGVuZENvbnN1bHRhdGlvbigpIHsNCiAgICAgIHRyeSB7DQogICAgICAgIGNvbnN0IGNvbmZpcm1lZCA9IGF3YWl0IHRoaXMuJGNvbmZpcm0oJ+ehruWumuimgee7k+adn+atpOasoeWSqOivouWQlz8nLCAn5o+Q56S6Jywgew0KICAgICAgICAgIGNvbmZpcm1CdXR0b25UZXh0OiAn56Gu5a6aJywNCiAgICAgICAgICBjYW5jZWxCdXR0b25UZXh0OiAn5Y+W5raIJywNCiAgICAgICAgICB0eXBlOiAnd2FybmluZycNCiAgICAgICAgfSkNCiAgICAgICAgDQogICAgICAgIGlmIChjb25maXJtZWQpIHsNCiAgICAgICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHRoaXMuJGF4aW9zLnB1dChgL2NvbnN1bHRhdGlvbi9lbmQvJHt0aGlzLmNvbnN1bHRhdGlvbklkfWApDQogICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEuY29kZSA9PT0gMjAwKSB7DQogICAgICAgICAgICB0aGlzLiRtZXNzYWdlLnN1Y2Nlc3MoJ+WSqOivouW3sue7k+adnycpDQogICAgICAgICAgICB0aGlzLmxvYWRDb25zdWx0YXRpb25EZXRhaWwoKQ0KICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICB0aGlzLiRtZXNzYWdlLmVycm9yKHJlc3BvbnNlLmRhdGEubXNnIHx8ICfnu5PmnZ/lkqjor6LlpLHotKUnKQ0KICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgfSBjYXRjaCAoZXJyb3IpIHsNCiAgICAgICAgaWYgKGVycm9yICE9PSAnY2FuY2VsJykgew0KICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ+e7k+adn+WSqOivouWHuumUmScsIGVycm9yKQ0KICAgICAgICAgIHRoaXMuJG1lc3NhZ2UuZXJyb3IoJ+e7k+adn+WSqOivouWHuumUmScpDQogICAgICAgIH0NCiAgICAgIH0NCiAgICB9LA0KICAgIC8vIOaYvuekuuWBpeW6t+aVsOaNruWvueivneahhg0KICAgIGFzeW5jIHNob3dIZWFsdGhEYXRhRGlhbG9nKCkgew0KICAgICAgdGhpcy5oZWFsdGhEYXRhRGlhbG9nVmlzaWJsZSA9IHRydWUNCiAgICAgIHRoaXMuaGVhbHRoRGF0YUxvYWRpbmcgPSB0cnVlDQogICAgICB0aGlzLnNlbGVjdGVkSGVhbHRoRGF0YSA9IG51bGwNCiAgICAgIA0KICAgICAgdHJ5IHsNCiAgICAgICAgY29uc3QgdXNlckluZm8gPSBKU09OLnBhcnNlKHNlc3Npb25TdG9yYWdlLmdldEl0ZW0oJ3VzZXJJbmZvJykpDQogICAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgdGhpcy4kYXhpb3MuZ2V0KGAvaGVhbHRoL3JlY29yZC9saXN0P3VzZXJJZD0ke3VzZXJJbmZvLmlkfWApDQogICAgICAgIGlmIChyZXNwb25zZS5kYXRhLmNvZGUgPT09IDIwMCkgew0KICAgICAgICAgIHRoaXMuaGVhbHRoRGF0YUxpc3QgPSByZXNwb25zZS5kYXRhLmRhdGEgfHwgW10NCiAgICAgICAgfQ0KICAgICAgfSBjYXRjaCAoZXJyb3IpIHsNCiAgICAgICAgY29uc29sZS5lcnJvcign6I635Y+W5YGl5bq35pWw5o2u5YiX6KGo5Ye66ZSZJywgZXJyb3IpDQogICAgICAgIHRoaXMuJG1lc3NhZ2UuZXJyb3IoJ+iOt+WPluWBpeW6t+aVsOaNruWIl+ihqOWHuumUmScpDQogICAgICB9IGZpbmFsbHkgew0KICAgICAgICB0aGlzLmhlYWx0aERhdGFMb2FkaW5nID0gZmFsc2UNCiAgICAgIH0NCiAgICB9LA0KICAgIC8vIOmAieaLqeWBpeW6t+aVsOaNrg0KICAgIHNlbGVjdEhlYWx0aERhdGEocm93KSB7DQogICAgICB0aGlzLnNlbGVjdGVkSGVhbHRoRGF0YSA9IHJvdw0KICAgIH0sDQogICAgLy8g5YiG5Lqr5YGl5bq35pWw5o2uDQogICAgYXN5bmMgc2hhcmVIZWFsdGhEYXRhKCkgew0KICAgICAgaWYgKCF0aGlzLnNlbGVjdGVkSGVhbHRoRGF0YSkgcmV0dXJuDQogICAgICANCiAgICAgIHRyeSB7DQogICAgICAgIGNvbnN0IG1lc3NhZ2UgPSB7DQogICAgICAgICAgY29uc3VsdGF0aW9uSWQ6IHRoaXMuY29uc3VsdGF0aW9uSWQsDQogICAgICAgICAgc2VuZGVySWQ6IHRoaXMuY3VycmVudFVzZXJJZCwNCiAgICAgICAgICBzZW5kZXJUeXBlOiAwLCAvLyAwOuaCo+iAhQ0KICAgICAgICAgIHJlY2VpdmVySWQ6IHRoaXMuY29uc3VsdGF0aW9uLmRvY3RvcklkLA0KICAgICAgICAgIGNvbnRlbnQ6ICfliIbkuqvlgaXlurfmlbDmja4nLA0KICAgICAgICAgIG1lc3NhZ2VUeXBlOiAyLCAvLyAyOuWBpeW6t+aVsOaNrg0KICAgICAgICAgIGhlYWx0aERhdGFJZDogdGhpcy5zZWxlY3RlZEhlYWx0aERhdGEuaWQsDQogICAgICAgICAgaXNSZWFkOiAwIC8vIDA65pyq6K+7DQogICAgICAgIH0NCiAgICAgICAgDQogICAgICAgIC8vIOWmguaenFdlYlNvY2tldOW3sui/nuaOpe+8jOS9v+eUqFdlYlNvY2tldOWIhuS6q+WBpeW6t+aVsOaNrg0KICAgICAgICBpZiAod2Vic29ja2V0U2VydmljZS5pc0Nvbm5lY3RlZCgpKSB7DQogICAgICAgICAgY29uc3Qgc3VjY2VzcyA9IHdlYnNvY2tldFNlcnZpY2Uuc2VuZE1lc3NhZ2UodGhpcy5jb25zdWx0YXRpb25JZCwgbWVzc2FnZSkNCiAgICAgICAgICBpZiAoc3VjY2Vzcykgew0KICAgICAgICAgICAgdGhpcy5oZWFsdGhEYXRhRGlhbG9nVmlzaWJsZSA9IGZhbHNlDQogICAgICAgICAgICB0aGlzLiRtZXNzYWdlLnN1Y2Nlc3MoJ+WBpeW6t+aVsOaNruWIhuS6q+aIkOWKnycpDQogICAgICAgICAgICByZXR1cm4NCiAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgDQogICAgICAgIC8vIFdlYlNvY2tldOWPkemAgeWksei0peaIluacqui/nuaOpe+8jOS9v+eUqEhUVFAgQVBJ5Y+R6YCBDQogICAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgdGhpcy4kYXhpb3MucG9zdCgnL2RvY3Rvci1tZXNzYWdlL3NoYXJlJywgbWVzc2FnZSkNCiAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEuY29kZSA9PT0gMjAwKSB7DQogICAgICAgICAgdGhpcy5oZWFsdGhEYXRhRGlhbG9nVmlzaWJsZSA9IGZhbHNlDQogICAgICAgICAgdGhpcy4kbWVzc2FnZS5zdWNjZXNzKCflgaXlurfmlbDmja7liIbkuqvmiJDlip8nKQ0KICAgICAgICAgIHRoaXMubG9hZE1lc3NhZ2VzKCkNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICB0aGlzLiRtZXNzYWdlLmVycm9yKHJlc3BvbnNlLmRhdGEubXNnIHx8ICfliIbkuqvlgaXlurfmlbDmja7lpLHotKUnKQ0KICAgICAgICB9DQogICAgICB9IGNhdGNoIChlcnJvcikgew0KICAgICAgICBjb25zb2xlLmVycm9yKCfliIbkuqvlgaXlurfmlbDmja7lh7rplJknLCBlcnJvcikNCiAgICAgICAgdGhpcy4kbWVzc2FnZS5lcnJvcign5YiG5Lqr5YGl5bq35pWw5o2u5Ye66ZSZJykNCiAgICAgIH0NCiAgICB9LA0KICAgIC8vIOWbvueJh+S4iuS8oOWJjemqjOivgQ0KICAgIGJlZm9yZUltYWdlVXBsb2FkKGZpbGUpIHsNCiAgICAgIGNvbnN0IGlzSW1hZ2UgPSBmaWxlLnR5cGUuc3RhcnRzV2l0aCgnaW1hZ2UvJykNCiAgICAgIGNvbnN0IGlzTHQ1TSA9IGZpbGUuc2l6ZSAvIDEwMjQgLyAxMDI0IDwgNQ0KICAgICAgDQogICAgICBpZiAoIWlzSW1hZ2UpIHsNCiAgICAgICAgdGhpcy4kbWVzc2FnZS5lcnJvcign5Y+q6IO95LiK5Lyg5Zu+54mH5paH5Lu2JykNCiAgICAgICAgcmV0dXJuIGZhbHNlDQogICAgICB9DQogICAgICBpZiAoIWlzTHQ1TSkgew0KICAgICAgICB0aGlzLiRtZXNzYWdlLmVycm9yKCflm77niYflpKflsI/kuI3og73otoXov4cgNU1CJykNCiAgICAgICAgcmV0dXJuIGZhbHNlDQogICAgICB9DQogICAgICByZXR1cm4gdHJ1ZQ0KICAgIH0sDQogICAgLy8g5Zu+54mH5LiK5Lyg5oiQ5YqfDQogICAgYXN5bmMgaGFuZGxlSW1hZ2VTdWNjZXNzKHJlcykgew0KICAgICAgaWYgKHJlcy5jb2RlICE9PSAyMDApIHsNCiAgICAgICAgdGhpcy4kbWVzc2FnZS5lcnJvcign5Zu+54mH5LiK5Lyg5aSx6LSlJykNCiAgICAgICAgcmV0dXJuDQogICAgICB9DQogICAgICANCiAgICAgIHRyeSB7DQogICAgICAgIGNvbnN0IGltYWdlVXJsID0gcmVzLmRhdGENCiAgICAgICAgY29uc3QgbWVzc2FnZSA9IHsNCiAgICAgICAgICBjb25zdWx0YXRpb25JZDogdGhpcy5jb25zdWx0YXRpb25JZCwNCiAgICAgICAgICByZWNlaXZlcklkOiB0aGlzLmNvbnN1bHRhdGlvbi5kb2N0b3JJZCwNCiAgICAgICAgICBjb250ZW50OiBpbWFnZVVybCwNCiAgICAgICAgICBtZXNzYWdlVHlwZTogMSwgLy8gMTrlm77niYcNCiAgICAgICAgICBpc1JlYWQ6IDAgLy8gMDrmnKror7sNCiAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCB0aGlzLiRheGlvcy5wb3N0KCcvZG9jdG9yLW1lc3NhZ2Uvc2VuZCcsIG1lc3NhZ2UpDQogICAgICAgIGlmIChyZXNwb25zZS5kYXRhLmNvZGUgPT09IDIwMCkgew0KICAgICAgICAgIHRoaXMuJG1lc3NhZ2Uuc3VjY2Vzcygn5Zu+54mH5Y+R6YCB5oiQ5YqfJykNCiAgICAgICAgICB0aGlzLmxvYWRNZXNzYWdlcygpDQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgdGhpcy4kbWVzc2FnZS5lcnJvcihyZXNwb25zZS5kYXRhLm1zZyB8fCAn5Y+R6YCB5Zu+54mH5aSx6LSlJykNCiAgICAgICAgfQ0KICAgICAgfSBjYXRjaCAoZXJyb3IpIHsNCiAgICAgICAgY29uc29sZS5lcnJvcign5Y+R6YCB5Zu+54mH5Ye66ZSZJywgZXJyb3IpDQogICAgICAgIHRoaXMuJG1lc3NhZ2UuZXJyb3IoJ+WPkemAgeWbvueJh+WHuumUmScpDQogICAgICB9DQogICAgfSwNCiAgICAvLyDmoLzlvI/ljJbooajmoLzml6XmnJ8NCiAgICBmb3JtYXRUYWJsZURhdGUocm93LCBjb2x1bW4sIGNlbGxWYWx1ZSkgew0KICAgICAgcmV0dXJuIHRoaXMuZm9ybWF0RGF0ZShjZWxsVmFsdWUpDQogICAgfSwNCiAgICAvLyDmoLzlvI/ljJbml6XmnJ8NCiAgICBmb3JtYXREYXRlKGRhdGVTdHIpIHsNCiAgICAgIGlmICghZGF0ZVN0cikgcmV0dXJuICcnDQogICAgICBjb25zdCBkYXRlID0gbmV3IERhdGUoZGF0ZVN0cikNCiAgICAgIHJldHVybiBgJHtkYXRlLmdldEZ1bGxZZWFyKCl9LSR7KGRhdGUuZ2V0TW9udGgoKSArIDEpLnRvU3RyaW5nKCkucGFkU3RhcnQoMiwgJzAnKX0tJHtkYXRlLmdldERhdGUoKS50b1N0cmluZygpLnBhZFN0YXJ0KDIsICcwJyl9ICR7ZGF0ZS5nZXRIb3VycygpLnRvU3RyaW5nKCkucGFkU3RhcnQoMiwgJzAnKX06JHtkYXRlLmdldE1pbnV0ZXMoKS50b1N0cmluZygpLnBhZFN0YXJ0KDIsICcwJyl9YA0KICAgIH0sDQogICAgLy8g5rua5Yqo5Yiw5bqV6YOoDQogICAgc2Nyb2xsVG9Cb3R0b20oKSB7DQogICAgICBpZiAodGhpcy4kcmVmcy5tZXNzYWdlc0NvbnRhaW5lcikgew0KICAgICAgICB0aGlzLiRyZWZzLm1lc3NhZ2VzQ29udGFpbmVyLnNjcm9sbFRvcCA9IHRoaXMuJHJlZnMubWVzc2FnZXNDb250YWluZXIuc2Nyb2xsSGVpZ2h0DQogICAgICB9DQogICAgfSwNCiAgICAvLyDlvIDlp4vova7or6INCiAgICBzdGFydFBvbGxpbmcoKSB7DQogICAgICB0aGlzLnBvbGxpbmdUaW1lciA9IHNldEludGVydmFsKCgpID0+IHsNCiAgICAgICAgdGhpcy5sb2FkTWVzc2FnZXMoKQ0KICAgICAgfSwgNTAwMCkgLy8g5q+PNeenkui9ruivouS4gOasoQ0KICAgIH0sDQogICAgLy8g5YGc5q2i6L2u6K+iDQogICAgc3RvcFBvbGxpbmcoKSB7DQogICAgICBpZiAodGhpcy5wb2xsaW5nVGltZXIpIHsNCiAgICAgICAgY2xlYXJJbnRlcnZhbCh0aGlzLnBvbGxpbmdUaW1lcikNCiAgICAgICAgdGhpcy5wb2xsaW5nVGltZXIgPSBudWxsDQogICAgICB9DQogICAgfQ0KICB9DQp9DQo="},{"version":3,"sources":["ConsultationChat.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAsKA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"ConsultationChat.vue","sourceRoot":"src/views/user","sourcesContent":["<template>\r\n  <div class=\"consultation-chat\">\r\n    <div class=\"chat-header\">\r\n      <el-button icon=\"el-icon-arrow-left\" @click=\"goBack\">返回</el-button>\r\n      <div class=\"consultation-info\" v-if=\"consultation\">\r\n        <h2>{{ consultation.title }}</h2>\r\n        <div class=\"status\">\r\n          <el-tag :type=\"consultation.status === 0 ? 'success' : 'info'\">\r\n            {{ consultation.status === 0 ? '进行中' : '已结束' }}\r\n          </el-tag>\r\n        </div>\r\n      </div>\r\n      <div class=\"actions\" v-if=\"consultation && consultation.status === 0\">\r\n        <el-button type=\"danger\" size=\"small\" @click=\"endConsultation\">结束会话</el-button>\r\n      </div>\r\n    </div>\r\n\r\n    <div class=\"chat-container\" v-loading=\"loading\">\r\n      <div class=\"chat-messages\" ref=\"messagesContainer\">\r\n        <template v-if=\"messages.length > 0\">\r\n          <div \r\n            v-for=\"(message, index) in messages\" \r\n            :key=\"index\" \r\n            :class=\"['message-item', { 'self': message.senderId === currentUserId }]\"\r\n          >\r\n            <div class=\"avatar\">\r\n              <el-avatar \r\n                :size=\"40\" \r\n                :src=\"message.senderId === currentUserId ? userAvatar : doctorAvatar\"\r\n              ></el-avatar>\r\n            </div>\r\n            <div class=\"message-content\">\r\n              <div class=\"sender-name\">{{ message.senderId === currentUserId ? '我' : doctorName }}</div>\r\n              \r\n              <!-- 文本消息 -->\r\n              <div v-if=\"message.messageType === 0\" class=\"text-content\">\r\n                {{ message.content }}\r\n              </div>\r\n              \r\n              <!-- 图片消息 -->\r\n              <div v-else-if=\"message.messageType === 1\" class=\"image-content\">\r\n                <el-image \r\n                  :src=\"message.content\" \r\n                  :preview-src-list=\"[message.content]\"\r\n                  fit=\"cover\"\r\n                  class=\"message-image\"\r\n                ></el-image>\r\n              </div>\r\n              \r\n              <!-- 健康数据消息 -->\r\n              <div v-else-if=\"message.messageType === 2\" class=\"health-data-content\">\r\n                <div class=\"health-data-card\">\r\n                  <div class=\"health-data-header\">\r\n                    <i class=\"el-icon-data-analysis\"></i>\r\n                    <span>健康数据分享</span>\r\n                  </div>\r\n                  <div class=\"health-data-body\" v-if=\"message.healthData\">\r\n                    <div class=\"health-data-item\">\r\n                      <span class=\"item-label\">健康模型:</span>\r\n                      <span class=\"item-value\">{{ message.healthData.name }}</span>\r\n                    </div>\r\n                    <div class=\"health-data-item\">\r\n                      <span class=\"item-label\">记录值:</span>\r\n                      <span class=\"item-value\">{{ message.healthData.value }} {{ message.healthData.unit }}</span>\r\n                    </div>\r\n                    <div class=\"health-data-item\">\r\n                      <span class=\"item-label\">记录时间:</span>\r\n                      <span class=\"item-value\">{{ formatDate(message.healthData.createTime) }}</span>\r\n                    </div>\r\n                  </div>\r\n                  <div class=\"health-data-body\" v-else>\r\n                    <p>加载健康数据中...</p>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n\r\n              <div class=\"message-time\">{{ formatDate(message.createTime) }}</div>\r\n            </div>\r\n          </div>\r\n        </template>\r\n        <div v-else class=\"empty-messages\">\r\n          <el-empty description=\"暂无消息记录\"></el-empty>\r\n        </div>\r\n      </div>\r\n\r\n      <div class=\"chat-input\" v-if=\"consultation && consultation.status === 0\">\r\n        <div class=\"input-actions\">\r\n          <el-tooltip content=\"分享健康数据\" placement=\"top\">\r\n            <el-button \r\n              icon=\"el-icon-data-analysis\" \r\n              circle \r\n              size=\"small\"\r\n              @click=\"showHealthDataDialog\"\r\n            ></el-button>\r\n          </el-tooltip>\r\n          <el-tooltip content=\"发送图片\" placement=\"top\">\r\n            <el-upload\r\n              class=\"image-upload\"\r\n              action=\"/api/personal-heath/v1.0/file/upload\"\r\n              :show-file-list=\"false\"\r\n              :on-success=\"handleImageSuccess\"\r\n              :before-upload=\"beforeImageUpload\"\r\n            >\r\n              <el-button \r\n                icon=\"el-icon-picture\" \r\n                circle \r\n                size=\"small\"\r\n              ></el-button>\r\n            </el-upload>\r\n          </el-tooltip>\r\n        </div>\r\n        <div class=\"input-box\">\r\n          <el-input\r\n            v-model=\"inputMessage\"\r\n            placeholder=\"输入消息...\"\r\n            type=\"textarea\"\r\n            :rows=\"3\"\r\n            @keyup.enter.native.ctrl=\"sendMessage\"\r\n          ></el-input>\r\n        </div>\r\n        <div class=\"send-button\">\r\n          <el-button type=\"primary\" @click=\"sendMessage\" :disabled=\"!inputMessage.trim()\">发送</el-button>\r\n        </div>\r\n      </div>\r\n      <div class=\"chat-ended\" v-else-if=\"consultation && consultation.status === 1\">\r\n        <el-alert\r\n          title=\"此咨询会话已结束\"\r\n          type=\"info\"\r\n          description=\"您可以通过创建新的咨询继续与医生交流\"\r\n          show-icon\r\n          :closable=\"false\"\r\n        ></el-alert>\r\n      </div>\r\n    </div>\r\n\r\n    <!-- 健康数据分享对话框 -->\r\n    <el-dialog title=\"分享健康数据\" :visible.sync=\"healthDataDialogVisible\" width=\"50%\">\r\n      <div class=\"health-data-list\" v-loading=\"healthDataLoading\">\r\n        <template v-if=\"healthDataList.length > 0\">\r\n          <el-table\r\n            :data=\"healthDataList\"\r\n            style=\"width: 100%\"\r\n            @row-click=\"selectHealthData\"\r\n            highlight-current-row\r\n          >\r\n            <el-table-column type=\"index\" width=\"50\"></el-table-column>\r\n            <el-table-column label=\"健康模型\" prop=\"name\"></el-table-column>\r\n            <el-table-column label=\"记录值\">\r\n              <template slot-scope=\"scope\">\r\n                {{ scope.row.value }} {{ scope.row.unit }}\r\n              </template>\r\n            </el-table-column>\r\n            <el-table-column prop=\"createTime\" label=\"记录时间\" :formatter=\"formatTableDate\"></el-table-column>\r\n          </el-table>\r\n        </template>\r\n        <el-empty v-else description=\"暂无健康数据记录\"></el-empty>\r\n      </div>\r\n      <span slot=\"footer\" class=\"dialog-footer\">\r\n        <el-button @click=\"healthDataDialogVisible = false\">取 消</el-button>\r\n        <el-button type=\"primary\" @click=\"shareHealthData\" :disabled=\"!selectedHealthData\">确认分享</el-button>\r\n      </span>\r\n    </el-dialog>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport websocketService from '@/utils/websocketService'\r\n\r\nexport default {\r\n  name: 'ConsultationChat',\r\n  data() {\r\n    return {\r\n      consultationId: null,\r\n      consultation: null,\r\n      messages: [],\r\n      loading: false,\r\n      inputMessage: '',\r\n      currentUserId: null,\r\n      userAvatar: '',\r\n      doctorAvatar: '',\r\n      doctorName: '',\r\n      // 健康数据\r\n      healthDataDialogVisible: false,\r\n      healthDataList: [],\r\n      healthDataLoading: false,\r\n      selectedHealthData: null,\r\n      // 轮询定时器\r\n      pollingTimer: null\r\n    }\r\n  },\r\n  created() {\r\n    this.consultationId = this.$route.params.id\r\n    // 获取当前用户信息\r\n    const userInfo = JSON.parse(sessionStorage.getItem('userInfo') || '{}')\r\n    this.currentUserId = userInfo.id\r\n    this.userAvatar = userInfo.url || '/img/default-avatar.png'\r\n    \r\n    // 初始化数据\r\n    this.loadConsultationDetail()\r\n    this.loadMessages()\r\n    \r\n    // 初始化WebSocket连接\r\n    this.initWebSocket()\r\n  },\r\n  beforeDestroy() {\r\n    // 断开WebSocket连接\r\n    websocketService.disconnect()\r\n  },\r\n  methods: {\r\n    // 返回上一页\r\n    goBack() {\r\n      this.$router.push('/doctor-consultation')\r\n    },\r\n    // 加载咨询详情\r\n    async loadConsultationDetail() {\r\n      if (!this.consultationId) return\r\n      \r\n      this.loading = true\r\n      try {\r\n        const response = await this.$axios.get(`/consultation/detail/${this.consultationId}`)\r\n        if (response.data.code === 200) {\r\n          this.consultation = response.data.data\r\n          \r\n          // 加载医生信息\r\n          await this.loadDoctorInfo(this.consultation.doctorId)\r\n        } else {\r\n          this.$message.error(response.data.msg || '获取咨询详情失败')\r\n        }\r\n      } catch (error) {\r\n        console.error('获取咨询详情出错', error)\r\n        this.$message.error('获取咨询详情出错')\r\n      } finally {\r\n        this.loading = false\r\n      }\r\n    },\r\n    // 加载医生信息\r\n    async loadDoctorInfo(doctorId) {\r\n      try {\r\n        const response = await this.$axios.get(`/doctor/detail/${doctorId}`)\r\n        if (response.data.code === 200) {\r\n          const doctor = response.data.data\r\n          this.doctorName = doctor.name\r\n          this.doctorAvatar = doctor.avatar || '/img/default-avatar.png'\r\n        }\r\n      } catch (error) {\r\n        console.error('获取医生信息出错', error)\r\n      }\r\n    },\r\n    // 加载消息列表\r\n    async loadMessages() {\r\n      if (!this.consultationId) return\r\n      \r\n      try {\r\n        const response = await this.$axios.get(`/doctor-message/list?consultationId=${this.consultationId}`)\r\n        if (response.data.code === 200) {\r\n          this.messages = response.data.data\r\n          \r\n          // 加载消息中的健康数据\r\n          this.loadMessagesHealthData()\r\n          \r\n          // 滚动到底部\r\n          this.$nextTick(() => {\r\n            this.scrollToBottom()\r\n          })\r\n        } else {\r\n          this.$message.error(response.data.msg || '获取消息列表失败')\r\n        }\r\n      } catch (error) {\r\n        console.error('获取消息列表出错', error)\r\n      }\r\n    },\r\n    // 加载消息中的健康数据\r\n    async loadMessagesHealthData() {\r\n      const healthDataMessages = this.messages.filter(m => m.messageType === 2 && m.healthDataId)\r\n      \r\n      for (const message of healthDataMessages) {\r\n        if (message.healthData) continue\r\n        \r\n        try {\r\n          const response = await this.$axios.get(`/health/record/detail/${message.healthDataId}`)\r\n          if (response.data.code === 200) {\r\n            this.$set(message, 'healthData', response.data.data)\r\n          }\r\n        } catch (error) {\r\n          console.error('获取健康数据详情出错', error)\r\n        }\r\n      }\r\n    },\r\n    // 初始化WebSocket连接\r\n    async initWebSocket() {\r\n      try {\r\n        await websocketService.connect(this.consultationId, this.handleNewMessage)\r\n      } catch (error) {\r\n        console.error('WebSocket连接失败，将使用轮询模式', error)\r\n        // 如果WebSocket连接失败，使用轮询作为备选方案\r\n        this.startPolling()\r\n      }\r\n    },\r\n    // 处理新消息\r\n    handleNewMessage(message) {\r\n      // 检查消息是否已存在（防止重复）\r\n      const exists = this.messages.some(m => m.id === message.id)\r\n      if (!exists) {\r\n        this.messages.push(message)\r\n        \r\n        // 如果是健康数据消息但没有健康数据详情，尝试加载\r\n        if (message.messageType === 2 && message.healthDataId && !message.healthData) {\r\n          this.loadHealthData(message)\r\n        }\r\n        \r\n        // 滚动到底部\r\n        this.$nextTick(() => {\r\n          this.scrollToBottom()\r\n        })\r\n      }\r\n    },\r\n    // 加载单条消息的健康数据\r\n    async loadHealthData(message) {\r\n      try {\r\n        const response = await this.$axios.get(`/health/record/detail/${message.healthDataId}`)\r\n        if (response.data.code === 200) {\r\n          this.$set(message, 'healthData', response.data.data)\r\n        }\r\n      } catch (error) {\r\n        console.error('获取健康数据详情出错', error)\r\n      }\r\n    },\r\n    // 发送消息\r\n    async sendMessage() {\r\n      if (!this.inputMessage.trim()) return\r\n      \r\n      try {\r\n        const message = {\r\n          consultationId: this.consultationId,\r\n          senderId: this.currentUserId,\r\n          senderType: 0, // 0:患者\r\n          receiverId: this.consultation.doctorId,\r\n          content: this.inputMessage,\r\n          messageType: 0, // 0:文本\r\n          isRead: 0 // 0:未读\r\n        }\r\n        \r\n        // 如果WebSocket已连接，使用WebSocket发送消息\r\n        if (websocketService.isConnected()) {\r\n          const success = websocketService.sendMessage(this.consultationId, message)\r\n          if (success) {\r\n            // 清空输入框\r\n            this.inputMessage = ''\r\n            return\r\n          }\r\n        }\r\n        \r\n        // WebSocket发送失败或未连接，使用HTTP API发送\r\n        const response = await this.$axios.post('/doctor-message/send', message)\r\n        if (response.data.code === 200) {\r\n          // 清空输入框\r\n          this.inputMessage = ''\r\n          // 重新加载消息\r\n          this.loadMessages()\r\n        } else {\r\n          this.$message.error(response.data.msg || '发送消息失败')\r\n        }\r\n      } catch (error) {\r\n        console.error('发送消息出错', error)\r\n        this.$message.error('发送消息出错')\r\n      }\r\n    },\r\n    // 结束会话\r\n    async endConsultation() {\r\n      try {\r\n        const confirmed = await this.$confirm('确定要结束此次咨询吗?', '提示', {\r\n          confirmButtonText: '确定',\r\n          cancelButtonText: '取消',\r\n          type: 'warning'\r\n        })\r\n        \r\n        if (confirmed) {\r\n          const response = await this.$axios.put(`/consultation/end/${this.consultationId}`)\r\n          if (response.data.code === 200) {\r\n            this.$message.success('咨询已结束')\r\n            this.loadConsultationDetail()\r\n          } else {\r\n            this.$message.error(response.data.msg || '结束咨询失败')\r\n          }\r\n        }\r\n      } catch (error) {\r\n        if (error !== 'cancel') {\r\n          console.error('结束咨询出错', error)\r\n          this.$message.error('结束咨询出错')\r\n        }\r\n      }\r\n    },\r\n    // 显示健康数据对话框\r\n    async showHealthDataDialog() {\r\n      this.healthDataDialogVisible = true\r\n      this.healthDataLoading = true\r\n      this.selectedHealthData = null\r\n      \r\n      try {\r\n        const userInfo = JSON.parse(sessionStorage.getItem('userInfo'))\r\n        const response = await this.$axios.get(`/health/record/list?userId=${userInfo.id}`)\r\n        if (response.data.code === 200) {\r\n          this.healthDataList = response.data.data || []\r\n        }\r\n      } catch (error) {\r\n        console.error('获取健康数据列表出错', error)\r\n        this.$message.error('获取健康数据列表出错')\r\n      } finally {\r\n        this.healthDataLoading = false\r\n      }\r\n    },\r\n    // 选择健康数据\r\n    selectHealthData(row) {\r\n      this.selectedHealthData = row\r\n    },\r\n    // 分享健康数据\r\n    async shareHealthData() {\r\n      if (!this.selectedHealthData) return\r\n      \r\n      try {\r\n        const message = {\r\n          consultationId: this.consultationId,\r\n          senderId: this.currentUserId,\r\n          senderType: 0, // 0:患者\r\n          receiverId: this.consultation.doctorId,\r\n          content: '分享健康数据',\r\n          messageType: 2, // 2:健康数据\r\n          healthDataId: this.selectedHealthData.id,\r\n          isRead: 0 // 0:未读\r\n        }\r\n        \r\n        // 如果WebSocket已连接，使用WebSocket分享健康数据\r\n        if (websocketService.isConnected()) {\r\n          const success = websocketService.sendMessage(this.consultationId, message)\r\n          if (success) {\r\n            this.healthDataDialogVisible = false\r\n            this.$message.success('健康数据分享成功')\r\n            return\r\n          }\r\n        }\r\n        \r\n        // WebSocket发送失败或未连接，使用HTTP API发送\r\n        const response = await this.$axios.post('/doctor-message/share', message)\r\n        if (response.data.code === 200) {\r\n          this.healthDataDialogVisible = false\r\n          this.$message.success('健康数据分享成功')\r\n          this.loadMessages()\r\n        } else {\r\n          this.$message.error(response.data.msg || '分享健康数据失败')\r\n        }\r\n      } catch (error) {\r\n        console.error('分享健康数据出错', error)\r\n        this.$message.error('分享健康数据出错')\r\n      }\r\n    },\r\n    // 图片上传前验证\r\n    beforeImageUpload(file) {\r\n      const isImage = file.type.startsWith('image/')\r\n      const isLt5M = file.size / 1024 / 1024 < 5\r\n      \r\n      if (!isImage) {\r\n        this.$message.error('只能上传图片文件')\r\n        return false\r\n      }\r\n      if (!isLt5M) {\r\n        this.$message.error('图片大小不能超过 5MB')\r\n        return false\r\n      }\r\n      return true\r\n    },\r\n    // 图片上传成功\r\n    async handleImageSuccess(res) {\r\n      if (res.code !== 200) {\r\n        this.$message.error('图片上传失败')\r\n        return\r\n      }\r\n      \r\n      try {\r\n        const imageUrl = res.data\r\n        const message = {\r\n          consultationId: this.consultationId,\r\n          receiverId: this.consultation.doctorId,\r\n          content: imageUrl,\r\n          messageType: 1, // 1:图片\r\n          isRead: 0 // 0:未读\r\n        }\r\n        \r\n        const response = await this.$axios.post('/doctor-message/send', message)\r\n        if (response.data.code === 200) {\r\n          this.$message.success('图片发送成功')\r\n          this.loadMessages()\r\n        } else {\r\n          this.$message.error(response.data.msg || '发送图片失败')\r\n        }\r\n      } catch (error) {\r\n        console.error('发送图片出错', error)\r\n        this.$message.error('发送图片出错')\r\n      }\r\n    },\r\n    // 格式化表格日期\r\n    formatTableDate(row, column, cellValue) {\r\n      return this.formatDate(cellValue)\r\n    },\r\n    // 格式化日期\r\n    formatDate(dateStr) {\r\n      if (!dateStr) return ''\r\n      const date = new Date(dateStr)\r\n      return `${date.getFullYear()}-${(date.getMonth() + 1).toString().padStart(2, '0')}-${date.getDate().toString().padStart(2, '0')} ${date.getHours().toString().padStart(2, '0')}:${date.getMinutes().toString().padStart(2, '0')}`\r\n    },\r\n    // 滚动到底部\r\n    scrollToBottom() {\r\n      if (this.$refs.messagesContainer) {\r\n        this.$refs.messagesContainer.scrollTop = this.$refs.messagesContainer.scrollHeight\r\n      }\r\n    },\r\n    // 开始轮询\r\n    startPolling() {\r\n      this.pollingTimer = setInterval(() => {\r\n        this.loadMessages()\r\n      }, 5000) // 每5秒轮询一次\r\n    },\r\n    // 停止轮询\r\n    stopPolling() {\r\n      if (this.pollingTimer) {\r\n        clearInterval(this.pollingTimer)\r\n        this.pollingTimer = null\r\n      }\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<style scoped lang=\"scss\">\r\n.consultation-chat {\r\n  height: calc(100vh - 150px);\r\n  display: flex;\r\n  flex-direction: column;\r\n  \r\n  .chat-header {\r\n    display: flex;\r\n    align-items: center;\r\n    padding: 15px 20px;\r\n    border-bottom: 1px solid #eee;\r\n    \r\n    .consultation-info {\r\n      flex: 1;\r\n      margin-left: 15px;\r\n      \r\n      h2 {\r\n        margin: 0 0 5px;\r\n        font-size: 18px;\r\n      }\r\n      \r\n      .status {\r\n        font-size: 14px;\r\n      }\r\n    }\r\n  }\r\n  \r\n  .chat-container {\r\n    flex: 1;\r\n    display: flex;\r\n    flex-direction: column;\r\n    overflow: hidden;\r\n    \r\n    .chat-messages {\r\n      flex: 1;\r\n      padding: 20px;\r\n      overflow-y: auto;\r\n      \r\n      .empty-messages {\r\n        display: flex;\r\n        justify-content: center;\r\n        align-items: center;\r\n        height: 100%;\r\n      }\r\n      \r\n      .message-item {\r\n        display: flex;\r\n        margin-bottom: 20px;\r\n        \r\n        &.self {\r\n          flex-direction: row-reverse;\r\n          \r\n          .message-content {\r\n            align-items: flex-end;\r\n            margin-right: 10px;\r\n            margin-left: 0;\r\n            \r\n            .text-content {\r\n              background-color: #15559a;\r\n              color: white;\r\n              border-top-right-radius: 0;\r\n              border-top-left-radius: 8px;\r\n            }\r\n            \r\n            .health-data-content {\r\n              align-self: flex-end;\r\n            }\r\n          }\r\n        }\r\n        \r\n        .avatar {\r\n          flex-shrink: 0;\r\n        }\r\n        \r\n        .message-content {\r\n          display: flex;\r\n          flex-direction: column;\r\n          margin-left: 10px;\r\n          max-width: 70%;\r\n          \r\n          .sender-name {\r\n            font-size: 12px;\r\n            color: #999;\r\n            margin-bottom: 5px;\r\n          }\r\n          \r\n          .text-content {\r\n            background-color: #f5f5f5;\r\n            padding: 10px 15px;\r\n            border-radius: 8px;\r\n            border-top-left-radius: 0;\r\n            word-break: break-word;\r\n          }\r\n          \r\n          .image-content {\r\n            max-width: 300px;\r\n            \r\n            .message-image {\r\n              max-width: 100%;\r\n              border-radius: 8px;\r\n            }\r\n          }\r\n          \r\n          .health-data-content {\r\n            .health-data-card {\r\n              border: 1px solid #eee;\r\n              border-radius: 8px;\r\n              overflow: hidden;\r\n              width: 300px;\r\n              \r\n              .health-data-header {\r\n                background-color: #f6f8fa;\r\n                padding: 10px;\r\n                font-weight: bold;\r\n                border-bottom: 1px solid #eee;\r\n                display: flex;\r\n                align-items: center;\r\n                \r\n                i {\r\n                  margin-right: 5px;\r\n                  color: #15559a;\r\n                }\r\n              }\r\n              \r\n              .health-data-body {\r\n                padding: 10px;\r\n                background-color: white;\r\n                \r\n                .health-data-item {\r\n                  display: flex;\r\n                  margin-bottom: 5px;\r\n                  \r\n                  .item-label {\r\n                    color: #666;\r\n                    width: 60px;\r\n                  }\r\n                  \r\n                  .item-value {\r\n                    font-weight: 500;\r\n                  }\r\n                }\r\n              }\r\n            }\r\n          }\r\n          \r\n          .message-time {\r\n            font-size: 12px;\r\n            color: #999;\r\n            margin-top: 5px;\r\n          }\r\n        }\r\n      }\r\n    }\r\n    \r\n    .chat-input {\r\n      padding: 15px;\r\n      border-top: 1px solid #eee;\r\n      display: flex;\r\n      \r\n      .input-actions {\r\n        display: flex;\r\n        flex-direction: column;\r\n        justify-content: center;\r\n        gap: 10px;\r\n        margin-right: 10px;\r\n        \r\n        .image-upload {\r\n          display: inline-block;\r\n        }\r\n      }\r\n      \r\n      .input-box {\r\n        flex: 1;\r\n      }\r\n      \r\n      .send-button {\r\n        align-self: flex-end;\r\n        margin-left: 10px;\r\n      }\r\n    }\r\n    \r\n    .chat-ended {\r\n      padding: 20px;\r\n    }\r\n  }\r\n  \r\n  .health-data-list {\r\n    max-height: 400px;\r\n    overflow-y: auto;\r\n  }\r\n}\r\n</style> "]}]}